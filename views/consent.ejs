<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome to <%= appName %> — Please review our policies</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #0f1117;
      color: #e6edf3;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
    }
    .consent-card {
      background: linear-gradient(180deg, #1a1d27 0%, #161920 100%);
      border: 1px solid #2a2d3a;
      border-radius: 20px;
      padding: 40px 44px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 24px 64px rgba(0,0,0,0.6);
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 28px;
    }
    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      object-fit: cover;
    }
    .brand-logo-fallback {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }
    .brand-name {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }
    .brand-ws {
      font-size: 12px;
      color: #6b7280;
    }
    h1 {
      font-size: 22px;
      font-weight: 800;
      margin-bottom: 6px;
      line-height: 1.3;
    }
    .subtitle {
      color: #8b949e;
      font-size: 14px;
      margin-bottom: 28px;
      line-height: 1.6;
    }
    .divider {
      height: 1px;
      background: #2a2d3a;
      margin-bottom: 24px;
    }
    .doc-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-bottom: 28px;
    }
    .doc-item {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      background: #12141c;
      border: 1px solid #2a2d3a;
      border-radius: 12px;
      padding: 14px 16px;
      cursor: pointer;
      transition: border-color 0.15s;
    }
    .doc-item:hover {
      border-color: #3b82f6;
    }
    .doc-item.checked {
      border-color: #22c55e;
      background: rgba(34,197,94,0.04);
    }
    .doc-checkbox {
      flex-shrink: 0;
      width: 22px;
      height: 22px;
      border-radius: 6px;
      border: 2px solid #374151;
      background: #0f1117;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 1px;
      transition: all 0.15s;
    }
    .doc-item.checked .doc-checkbox {
      background: #22c55e;
      border-color: #22c55e;
    }
    .doc-checkbox svg {
      display: none;
    }
    .doc-item.checked .doc-checkbox svg {
      display: block;
    }
    .doc-content {
      flex: 1;
    }
    .doc-title {
      font-size: 15px;
      font-weight: 600;
      color: #e6edf3;
      margin-bottom: 3px;
    }
    .doc-desc {
      font-size: 13px;
      color: #6b7280;
      line-height: 1.5;
    }
    .doc-link {
      display: inline-block;
      margin-top: 6px;
      font-size: 12px;
      color: #60a5fa;
      text-decoration: none;
    }
    .doc-link:hover {
      text-decoration: underline;
    }
    /* Hidden actual checkboxes */
    input[type="checkbox"].hidden-check {
      display: none;
    }
    .btn-accept {
      width: 100%;
      padding: 14px;
      background: linear-gradient(180deg, #22c55e, #16a34a);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      opacity: 0.4;
      pointer-events: none;
      transition: opacity 0.2s;
    }
    .btn-accept.enabled {
      opacity: 1;
      pointer-events: auto;
    }
    .btn-accept.enabled:hover {
      background: linear-gradient(180deg, #16a34a, #15803d);
    }
    .footer-note {
      margin-top: 16px;
      text-align: center;
      font-size: 12px;
      color: #4b5563;
    }
    .footer-note a {
      color: #60a5fa;
      text-decoration: none;
    }
    .error-msg {
      background: #1f1014;
      border: 1px solid #ef4444;
      color: #f87171;
      padding: 10px 14px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 14px;
    }
  </style>
</head>
<body>
<div class="consent-card">

  <!-- Brand / workspace header -->
  <div class="brand">
    <% if (workspace && workspace.branding && workspace.branding.favicon) { %>
      <img src="<%= workspace.branding.favicon %>" class="brand-logo" alt="Logo">
    <% } else { %>
      <div class="brand-logo-fallback"><%= (workspace ? workspace.name : appName).charAt(0).toUpperCase() %></div>
    <% } %>
    <div>
      <div class="brand-name"><%= workspace ? workspace.name : appName %></div>
      <div class="brand-ws">Powered by <%= appName %></div>
    </div>
  </div>

  <h1>Welcome! Just before you start...</h1>
  <p class="subtitle">
    Please read and tick each policy below. These documents explain your rights,
    how we handle your data, and the rules for using this platform.
    You only need to do this once.
  </p>

  <div class="divider"></div>

  <% if (typeof error !== 'undefined' && error) { %>
    <div class="error-msg"><%= error %></div>
  <% } %>

  <form method="POST" action="/consent" id="consentForm">
    <input type="hidden" name="_security-token" value="<%= security-tokenToken %>">

    <div class="doc-list">

      <!-- 1. Terms of Service -->
      <div class="doc-item" id="item-tos" onclick="toggleCheck('tos')">
        <div class="doc-checkbox" id="check-tos">
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none">
            <path d="M2 6.5L5 9.5L11 3.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="doc-content">
          <div class="doc-title">Terms of Service</div>
          <div class="doc-desc">Covers how the platform works, your responsibilities, and what happens if things go wrong. Includes liability limitations and account rules.</div>
          <a href="/terms" target="_blank" class="doc-link" onclick="event.stopPropagation()">Read Terms of Service →</a>
        </div>
        <input type="checkbox" name="tos" value="1" class="hidden-check" id="cb-tos">
      </div>

      <!-- 2. Privacy Policy -->
      <div class="doc-item" id="item-privacy" onclick="toggleCheck('privacy')">
        <div class="doc-checkbox" id="check-privacy">
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none">
            <path d="M2 6.5L5 9.5L11 3.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="doc-content">
          <div class="doc-title">Privacy Policy</div>
          <div class="doc-desc">Explains what personal data we collect (like driver names), why we store it, who can access it, and your rights under Australian privacy law.</div>
          <a href="/privacy" target="_blank" class="doc-link" onclick="event.stopPropagation()">Read Privacy Policy →</a>
        </div>
        <input type="checkbox" name="privacy" value="1" class="hidden-check" id="cb-privacy">
      </div>

      <!-- 3. Data Responsibility -->
      <div class="doc-item" id="item-data" onclick="toggleCheck('data')">
        <div class="doc-checkbox" id="check-data">
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none">
            <path d="M2 6.5L5 9.5L11 3.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="doc-content">
          <div class="doc-title">Data Responsibility & Retention</div>
          <div class="doc-desc">You own your compliance records. This explains who controls your data, how long it's kept, and that you're responsible for meeting your regulatory obligations — not us.</div>
          <a href="/data-responsibility" target="_blank" class="doc-link" onclick="event.stopPropagation()">Read Data Policy →</a>
        </div>
        <input type="checkbox" name="data" value="1" class="hidden-check" id="cb-data">
      </div>

      <!-- 4. Acceptable Use -->
      <div class="doc-item" id="item-use" onclick="toggleCheck('use')">
        <div class="doc-checkbox" id="check-use">
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none">
            <path d="M2 6.5L5 9.5L11 3.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="doc-content">
          <div class="doc-title">Acceptable Use Policy</div>
          <div class="doc-desc">A short list of things that aren't allowed — like entering false data, storing illegal content, or trying to break the system.</div>
          <a href="/acceptable-use" target="_blank" class="doc-link" onclick="event.stopPropagation()">Read Acceptable Use →</a>
        </div>
        <input type="checkbox" name="use" value="1" class="hidden-check" id="cb-use">
      </div>

      <!-- 5. Contact & Identification -->
      <div class="doc-item" id="item-contact" onclick="toggleCheck('contact')">
        <div class="doc-checkbox" id="check-contact">
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none">
            <path d="M2 6.5L5 9.5L11 3.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="doc-content">
          <div class="doc-title">Who We Are</div>
          <div class="doc-desc">
            <strong style="color:#e6edf3"><%= appName %></strong> — Temperature compliance platform.<br>
            Based in <strong style="color:#e6edf3">Western Australia, Australia</strong>.<br>
            Contact: <a href="mailto:<%= supportEmail %>" style="color:#60a5fa;" onclick="event.stopPropagation()"><%= supportEmail %></a>
          </div>
        </div>
        <input type="checkbox" name="contact" value="1" class="hidden-check" id="cb-contact">
      </div>

    </div>


    <button type="submit" class="btn-accept" id="btnAccept">
      I agree — Take me to the platform
    </button>

  </form>

  <p class="footer-note">
    By continuing you confirm you're authorised to accept these on behalf of your organisation.
    &nbsp;&bull;&nbsp; <a href="/terms">Terms</a> &nbsp;&bull;&nbsp; <a href="/privacy">Privacy</a>
  </p>

</div>

<script>
const KEYS = ['tos', 'privacy', 'data', 'use', 'contact'];

function toggleCheck(key) {
  const cb = document.getElementById('cb-' + key);
  cb.checked = !cb.checked;
  updateUI(key, cb.checked);
  updateButton();
}

function updateUI(key, checked) {
  const item = document.getElementById('item-' + key);
  const check = document.getElementById('check-' + key);
  if (checked) {
    item.classList.add('checked');
  } else {
    item.classList.remove('checked');
  }
}



function updateButton() {
  const allChecked = KEYS.every(k => document.getElementById('cb-' + k).checked);
  const btn = document.getElementById('btnAccept');
  if (allChecked) {
    btn.classList.add('enabled');
  } else {
    btn.classList.remove('enabled');
  }
}

// Init
updateButton();
</script>
</body>
</html>
